<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>الرياضيات - Six Pro</title>
    <!-- 1. Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 2. Tailwind Config for consistent theme -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'sans': ['Tajawal', 'sans-serif'],
                    },
                    colors: {
                        'primary': {
                            50: '#f0f4ff',
                            100: '#e0e7ff',
                            200: '#c7d2fe',
                            300: '#a5b4fc',
                            400: '#818cf8',
                            500: '#667eea', // Main primary color
                            600: '#4f46e5',
                            700: '#4338ca',
                            800: '#3730a3',
                            900: '#312e81',
                        },
                        'secondary': {
                            50: '#f0f1f9',
                            100: '#e0e1f0',
                            200: '#c8cbe6',
                            300: '#a9afda',
                            400: '#8a93ce',
                            500: '#764ba2', // Main secondary color
                            600: '#6b4193',
                            700: '#5a377a',
                            800: '#492d60',
                            900: '#382447',
                        },
                        'glass': {
                            DEFAULT: 'rgba(255, 255, 255, 0.1)',
                            'border': 'rgba(255, 255, 255, 0.2)',
                        }
                    },
                    borderRadius: {
                        'xl': '0.75rem',
                        '2xl': '1rem',
                        '3xl': '1.5rem',
                    },
                    boxShadow: {
                        'glass': '0 4px 30px rgba(0, 0, 0, 0.1)',
                        'glass-hover': '0 20px 40px rgba(0, 0, 0, 0.2), 0 4px 20px rgba(102, 126, 234, 0.6), 0 6px 30px rgba(118, 75, 162, 0.4)',
                        'button-hover': '0 0 15px rgba(102, 126, 234, 0.7)',
                    },
                    animation: {
                        'gradient-shift': 'gradientShift 12s ease infinite',
                        'scale-click': 'scaleClick 0.2s ease-in-out forwards',
                        'fade-click': 'fadeClick 0.2s ease-in-out forwards',
                        'fade-in': 'fadeIn 0.3s ease'
                    },
                    keyframes: {
                        gradientShift: {
                            '0%, 100%': { 'background-position': '0% 50%' },
                            '50%': { 'background-position': '100% 50%' },
                        },
                        scaleClick: {
                            '0%': { transform: 'scale(1)' },
                            '50%': { transform: 'scale(0.95)' },
                            '100%': { transform: 'scale(1)' },
                        },
                        fadeClick: {
                            '0%': { opacity: '0.8' },
                            '50%': { opacity: '0.6' },
                            '100%': { opacity: '0.8' },
                        },
                        fadeIn: {
                            'from': { opacity: 0, transform: 'translateY(10px)' },
                            'to': { opacity: 1, transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>
    <!-- 3. Feather Icons -->
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <!-- 4. Tajawal Font -->
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- 5. Custom CSS -->
    <style>
        body {
            font-family: 'Tajawal', sans-serif;
            background: linear-gradient(-45deg, #667eea, #764ba2, #6B8DD6, #8E37D7);
            background-size: 400% 400%;
            animation: gradientShift 12s ease infinite;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        .glass-card {
            background: theme('colors.glass.DEFAULT');
            backdrop-filter: blur(10px);
            border: 1px solid theme('colors.glass.border');
            transition: all 0.3s ease;
            box-shadow: theme('boxShadow.glass');
        }

        .tab-active {
            border-bottom: 3px solid theme('colors.primary.100');
            color: theme('colors.primary.100');
            font-weight: 600;
        }

        .table-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .table-card:hover {
            transform: translateY(-3px);
            box-shadow: theme('boxShadow.glass-hover');
        }

        .feedback-message {
            animation: fade-in 0.3s ease;
        }

        .stats-card {
            transition: all 0.3s ease;
        }

        .stats-card:hover {
            transform: translateY(-3px);
            box-shadow: theme('boxShadow.glass-hover');
        }

        .multiplication-table {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
        }

        @media (max-width: 1024px) {
            .multiplication-table {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 640px) {
            .multiplication-table {
                grid-template-columns: 1fr;
            }
        }

        .circular-progress {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: 
                radial-gradient(circle at center, white 60%, transparent 61%),
                conic-gradient(theme('colors.primary.500') 0%, theme('colors.primary.500') 0);
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .circular-progress::before {
            content: attr(data-progress) "%";
            font-size: 1.5rem;
            font-weight: bold;
            color: theme('colors.primary.500');
        }

        /* For preventing text selection and touch highlight */
        * {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        html, body {
            overscroll-behavior: none;
            touch-action: manipulation;
        }

        /* NEW: Bottom Navigation Styles */
        .nav-item {
            transition: color 0.2s ease, transform 0.2s ease, opacity 0.2s ease;
        }

        .nav-item.active {
            color: theme('colors.white');
        }

        .nav-item:active {
            animation: scale-click 0.2s ease-in-out forwards, fade-click 0.2s ease-in-out forwards;
        }

        /* Content Area Styling */
        .main-content {
            padding-bottom: 80px; /* Space for fixed nav bar */
        }
    </style>
</head>
<body class="min-h-screen overflow-x-hidden relative">
    <!-- Header -->
    <header class="relative z-10 p-6">
        <div class="max-w-6xl mx-auto flex items-center">
            <a href="index.html" class="text-white">
                <i data-feather="arrow-right" class="w-6 h-6"></i>
            </a>
            <h1 class="text-xl font-bold text-white mx-auto">الرياضيات</h1>
        </div>
    </header>

    <!-- Main Content Area -->
    <main class="main-content relative z-10 max-w-6xl mx-auto px-4 py-6">
        <!-- Tabs -->
        <div class="flex border-b border-white/20 mb-4">
            <button id="tables-tab" class="px-4 py-2 text-white tab-active">الجداول</button>
            <button id="stats-tab" class="px-4 py-2 text-purple-200">الإحصائيات</button>
            <button id="test-tab" class="px-4 py-2 text-purple-200">الاختبار</button>
        </div>

        <!-- Tables Content -->
        <div id="tables-content" class="container mx-auto px-4 py-6">
            <div class="glass-card rounded-xl p-6">
                <h3 class="font-bold text-white mb-4 text-center">جداول الضرب</h3>
                <div class="multiplication-table">
                    <!-- Tables will be generated here -->
                </div>
            </div>
        </div>

        <!-- Stats Content -->
        <div id="stats-content" class="container mx-auto px-4 py-6 hidden">
            <div class="glass-card rounded-xl p-6">
                <h3 class="font-bold text-white mb-6 text-center">إحصائياتك</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="stats-card bg-white/10 p-6 rounded-lg">
                        <h4 class="font-bold text-white mb-4">الأسئلة</h4>
                        <div class="space-y-3">
                            <div class="flex justify-between text-white">
                                <span>إجمالي الأسئلة:</span>
                                <span id="total-questions" class="font-bold">0</span>
                            </div>
                            <div class="flex justify-between text-white">
                                <span>الإجابات الصحيحة:</span>
                                <span id="correct-answers" class="font-bold text-green-300">0</span>
                            </div>
                            <div class="flex justify-between text-white">
                                <span>الإجابات الخاطئة:</span>
                                <span id="incorrect-answers" class="font-bold text-red-300">0</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="stats-card bg-white/10 p-6 rounded-lg">
                        <h4 class="font-bold text-white mb-4">نسبة النجاح</h4>
                        <div class="flex flex-col items-center">
                            <div class="circular-progress mb-4" data-progress="0"></div>
                            <p id="success-advice" class="text-center text-purple-200 text-sm">
                                ابدأ بالإجابة على بعض الأسئلة لترى إحصائياتك
                            </p>
                        </div>
                    </div>
                    
                    <div class="stats-card bg-white/10 p-6 rounded-lg md:col-span-2">
                        <h4 class="font-bold text-white mb-2">أكثر الأسئلة خطأً</h4>
                        <div id="common-mistakes" class="text-center text-purple-200">
                            لا توجد بيانات حتى الآن
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Test Content -->
        <div id="test-content" class="container mx-auto px-4 py-6 hidden">
            <div class="glass-card rounded-xl p-6">
                <div class="text-center py-8">
                    <h2 id="test-question" class="text-4xl md:text-5xl font-bold text-white mb-8">1 × 1 = ؟</h2>
                    <input type="number" id="test-answer" class="border border-white/30 rounded-lg px-4 py-3 mb-4 w-32 text-center text-xl focus:outline-none focus:ring-2 focus:ring-white/50 bg-white/20 text-white placeholder:text-white/50" placeholder="الجواب" autocomplete="off">
                    <button id="submit-test-answer" class="bg-white text-indigo-600 px-6 py-3 rounded-lg font-bold hover:bg-gray-100 transition-colors">تحقق</button>
                    <div id="test-feedback-container" class="mt-4 min-h-[32px]">
                        <p id="test-feedback" class="feedback-message font-bold hidden"></p>
                    </div>
                    <div class="mt-8 text-sm text-purple-200">
                        <p>السؤال: <span id="question-number">1</span></p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- NEW: Bottom Navigation Bar -->
    <nav class="fixed bottom-0 left-0 right-0 z-20 glass-card rounded-t-3xl">
        <div class="max-w-6xl mx-auto px-4 py-3">
            <div class="flex justify-around items-center">
                <a href="index.html" class="nav-item flex flex-col items-center space-y-1 text-purple-200 button-hover-glow btn-nav" data-title="الصفحة الرئيسية" title="الصفحة الرئيسية">
                    <i data-feather="home" class="w-6 h-6"></i>
                    <span class="text-xs">الرئيسية</span>
                </a>
                <a href="tasks.html" class="nav-item flex flex-col items-center space-y-1 text-purple-200 button-hover-glow btn-nav" data-title="المهام" title="المهام">
                    <i data-feather="check-square" class="w-6 h-6"></i>
                    <span class="text-xs">المهام</span>
                </a>
                <a href="math.html" class="nav-item flex flex-col items-center space-y-1 text-white button-hover-glow btn-nav active" data-title="الرياضيات" title="الرياضيات">
                    <i data-feather="calculator" class="w-6 h-6"></i>
                    <span class="text-xs">الرياضيات</span>
                </a>
                <a href="notifications.html" class="nav-item flex flex-col items-center space-y-1 text-purple-200 button-hover-glow btn-nav" data-title="التنبيهات" title="التنبيهات">
                    <i data-feather="bell" class="w-6 h-6"></i>
                    <span class="text-xs">التنبيهات</span>
                </a>
                <a href="profile.html" class="nav-item flex flex-col items-center space-y-1 text-purple-200 button-hover-glow btn-nav" data-title="الاعدادات" title="الإعدادات">
                    <i data-feather="user" class="w-6 h-6"></i>
                    <span class="text-xs">الاعدادات</span>
                </a>
            </div>
        </div>
    </nav>

    <script>
        // Initialize feather icons
        feather.replace();
        
        // Global variables
        let stats = {
            totalQuestions: 0,
            correctAnswers: 0,
            incorrectAnswers: 0,
            mistakes: {} // Object to track mistakes: { "3x7": 5 } means 3x7 was answered incorrectly 5 times
        };
        
        let currentQuestion = 0;
        let usedQuestions = new Set(); // To track used questions and avoid repetition
        
        // DOM Elements
        const tablesTab = document.getElementById('tables-tab');
        const statsTab = document.getElementById('stats-tab');
        const testTab = document.getElementById('test-tab');
        const tablesContent = document.getElementById('tables-content');
        const statsContent = document.getElementById('stats-content');
        const testContent = document.getElementById('test-content');
        const testQuestion = document.getElementById('test-question');
        const testAnswer = document.getElementById('test-answer');
        const submitTestAnswer = document.getElementById('submit-test-answer');
        const testFeedback = document.getElementById('test-feedback');
        const questionNumber = document.getElementById('question-number');
        const circularProgress = document.querySelector('.circular-progress');
        const successAdvice = document.getElementById('success-advice');
        
        // --- NEW: Handle Bottom Navigation Clicks (Second Phase) ---
        document.querySelectorAll('.btn-nav').forEach(button => {
            button.addEventListener('click', function(event) {
                event.preventDefault(); // Prevent default navigation for now

                // Remove 'active' class from all nav items
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('active');
                    item.classList.remove('text-white');
                    item.classList.add('text-purple-200');
                });

                // Add 'active' class to clicked item
                this.classList.add('active');
                this.classList.remove('text-purple-200');
                this.classList.add('text-white');

                const title = this.getAttribute('data-title');
                const href = this.getAttribute('href');
                console.log(`Navigating to: ${href} (Title: ${title})`); // Log for clarity
                // In a real SPA, this would trigger page load
                window.location.href = href; // Navigate to the page
            });
        });
        
        // Tab switching
        tablesTab.addEventListener('click', () => {
            tablesContent.classList.remove('hidden');
            statsContent.classList.add('hidden');
            testContent.classList.add('hidden');
            tablesTab.classList.add('tab-active');
            statsTab.classList.remove('tab-active');
            testTab.classList.remove('tab-active');
        });
        
        statsTab.addEventListener('click', () => {
            tablesContent.classList.add('hidden');
            statsContent.classList.remove('hidden');
            testContent.classList.add('hidden');
            statsTab.classList.add('tab-active');
            tablesTab.classList.remove('tab-active');
            testTab.classList.remove('tab-active');
            updateStatsDisplay();
        });
        
        testTab.addEventListener('click', () => {
            tablesContent.classList.add('hidden');
            statsContent.classList.add('hidden');
            testContent.classList.remove('hidden');
            testTab.classList.add('tab-active');
            tablesTab.classList.remove('tab-active');
            statsTab.classList.remove('tab-active');
            initTest();
        });
        
        // Generate all multiplication tables
        function generateAllTables() {
            const container = document.querySelector('.multiplication-table');
            container.innerHTML = '';
            
            for (let tableNum = 1; tableNum <= 11; tableNum++) {
                const tableContainer = document.createElement('div');
                tableContainer.className = 'glass-card rounded-lg p-4 table-card'; // Added table-card class
                
                const tableTitle = document.createElement('h4');
                tableTitle.className = 'font-bold text-center mb-2 text-white';
                tableTitle.textContent = `جدول ${tableNum}`;
                tableContainer.appendChild(tableTitle);
                
                const tableList = document.createElement('ul');
                tableList.className = 'space-y-1';
                
                for (let i = 1; i <= 10; i++) {
                    const listItem = document.createElement('li');
                    listItem.className = 'flex justify-between text-sm text-white';
                    listItem.innerHTML = `
                        <span>${tableNum} × ${i} =</span>
                        <span class="font-medium">${tableNum * i}</span>
                    `;
                    tableList.appendChild(listItem);
                }
                
                tableContainer.appendChild(tableList);
                container.appendChild(tableContainer);
            }
        }
        
        // Initialize test
        function initTest() {
            currentQuestion = 1;
            usedQuestions.clear();
            showTestQuestion();
        }
        
        // Show test question
        function showTestQuestion() {
            // Generate a random question
            const num1 = Math.floor(Math.random() * 11) + 1; // 1-11
            const num2 = Math.floor(Math.random() * 10) + 1; // 1-10
            const questionKey = `${num1}×${num2}`;
            
            // Avoid repetition
            if (usedQuestions.has(questionKey) && usedQuestions.size < 110) {
                showTestQuestion(); // Try again
                return;
            }
            
            usedQuestions.add(questionKey);
            
            testQuestion.textContent = `${num1} × ${num2} = ؟`;
            testAnswer.value = '';
            testAnswer.style.display = 'inline-block';
            submitTestAnswer.style.display = 'inline-block';
            testAnswer.focus();
            
            questionNumber.textContent = currentQuestion;
            testFeedback.classList.add('hidden');
        }
        
        // Check test answer
        submitTestAnswer.addEventListener('click', checkTestAnswer);
        testAnswer.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') checkTestAnswer();
        });
        
        function checkTestAnswer() {
            const userAnswer = parseInt(testAnswer.value);
            const [num1, num2] = testQuestion.textContent.replace(' = ؟', '').split(' × ').map(Number);
            const correctAnswer = num1 * num2;
            
            if (isNaN(userAnswer)) {
                showTestFeedback('يرجى إدخال رقم', 'text-yellow-300');
                return;
            }
            
            stats.totalQuestions++;
            currentQuestion++;
            
            if (userAnswer === correctAnswer) {
                const successMessages = ['عاش!', 'بطل!', 'واو!', 'رائع!', 'ذيب!', 'استمر!'];
                const message = successMessages[Math.floor(Math.random() * successMessages.length)];
                showTestFeedback(message, 'text-green-300');
                stats.correctAnswers++;
            } else {
                const encouragementMessages = ['حاول لا بد من النجاح!', 'استمر، ستفعلها!', 'لا تستسلم!', 'المحاولة القادمة ستكون أفضل!'];
                const message = encouragementMessages[Math.floor(Math.random() * encouragementMessages.length)];
                showTestFeedback(`${message} الإجابة الصحيحة: ${correctAnswer}`, 'text-red-300');
                stats.incorrectAnswers++;
                
                // Track mistake
                const mistakeKey = `${num1}×${num2}`;
                stats.mistakes[mistakeKey] = (stats.mistakes[mistakeKey] || 0) + 1;
            }
            
            // Save stats to localStorage
            localStorage.setItem('mathStats', JSON.stringify(stats));
            
            // Move to next question after delay
            setTimeout(() => {
                showTestQuestion();
            }, 1500);
        }
        
        // Show test feedback
        function showTestFeedback(message, colorClass) {
            testFeedback.textContent = message;
            testFeedback.className = `feedback-message font-bold ${colorClass}`;
            testFeedback.classList.remove('hidden');
        }
        
        // Update stats display
        function updateStatsDisplay() {
            document.getElementById('total-questions').textContent = stats.totalQuestions;
            document.getElementById('correct-answers').textContent = stats.correctAnswers;
            document.getElementById('incorrect-answers').textContent = stats.incorrectAnswers;
            
            // Update circular progress
            const successRate = stats.totalQuestions > 0 ? 
                Math.round((stats.correctAnswers / stats.totalQuestions) * 100) : 0;
            circularProgress.setAttribute('data-progress', successRate);
            circularProgress.style.background = 
                `radial-gradient(circle at center, rgba(255,255,255,0.9) 60%, transparent 61%), conic-gradient(theme('colors.primary.500') 0% ${successRate}%, #4b5563 ${successRate}% 100%)`;
            
            // Update advice
            if (stats.totalQuestions === 0) {
                successAdvice.textContent = 'ابدأ بالإجابة على بعض الأسئلة لترى إحصائياتك';
            } else if (successRate >= 90) {
                successAdvice.textContent = 'ممتاز! استمر بالتحسن';
            } else if (successRate >= 70) {
                successAdvice.textContent = 'جيد جداً! واصل العمل الجيد';
            } else if (successRate >= 50) {
                successAdvice.textContent = 'جيد، لكن يمكنك التحسن أكثر مع الممارسة';
            } else {
                successAdvice.textContent = 'لا تستسلم! الممارسة تؤدي إلى التميز';
            }
            
            // Show common mistakes
            const mistakesContainer = document.getElementById('common-mistakes');
            if (Object.keys(stats.mistakes).length === 0) {
                mistakesContainer.textContent = 'لا توجد بيانات حتى الآن';
            } else {
                // Sort mistakes by frequency
                const sortedMistakes = Object.entries(stats.mistakes)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 5); // Top 5 mistakes
                
                if (sortedMistakes.length === 0) {
                    mistakesContainer.textContent = 'لا توجد بيانات حتى الآن';
                } else {
                    mistakesContainer.innerHTML = '';
                    sortedMistakes.forEach(([question, count]) => {
                        const mistakeElement = document.createElement('div');
                        mistakeElement.className = 'mb-2 text-white';
                        mistakeElement.textContent = `${question} - أخطأت ${count} مرة`;
                        mistakesContainer.appendChild(mistakeElement);
                    });
                }
            }
        }
        
        // Load stats from localStorage
        function loadStats() {
            const savedStats = localStorage.getItem('mathStats');
            if (savedStats) {
                stats = JSON.parse(savedStats);
            }
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadStats();
            generateAllTables();
        });
    </script>
</body>
</html>
